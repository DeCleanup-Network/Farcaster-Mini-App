# Base Build Ownership Verification Guide

## Understanding Ownership vs. Account Association

When your `baseBuilder.ownerAddress` is different from your Base Build account address, you need to understand two separate concepts:

### 1. **accountAssociation** (Required for Verification)
- **Purpose**: Cryptographically links your domain to your Base Build account
- **How it works**: Base Build generates a signed JWT that proves you control the domain
- **Generated by**: Base Build interface (you sign with your Base Build account wallet)
- **Contains**: `header`, `payload`, `signature` (all generated by Base Build)

### 2. **baseBuilder.ownerAddress** (Informational)
- **Purpose**: Identifies who owns/controls the Mini App
- **Can be different**: This address doesn't need to match your Base Build account
- **Use cases**: 
  - Your organization's main wallet
  - A multi-sig wallet
  - A different address for operational purposes

## Step-by-Step Verification Process

### Step 1: Access Base Build Account Association Tool

1. **Log into Base Build**
   - Go to [base.org](https://base.org) and sign in
   - Navigate to **Base Build** section
   - Find your Mini App: "DeCleanup Network"

2. **Open Account Association Tool**
   - In Base Build, look for "Account Association" or "Verify Domain" section
   - Or go directly to: [Base Build Manifest Tool](https://base.org/mini-apps/features/manifest)

### Step 2: Generate accountAssociation

1. **Enter Your Domain**
   - In the tool, enter your app's domain:
     ```
     farcaster-mini-app-umber.vercel.app
     ```
   - Make sure it matches your `homeUrl` exactly (without `https://`)

2. **Click "Verify" or "Generate"**
   - Base Build will prompt you to sign a message with your wallet
   - **Important**: Sign with the wallet connected to your Base Build account
   - This creates the cryptographic proof linking your domain to your account

3. **Copy the Generated Values**
   - You'll receive three values:
     - `header`: Base64-encoded JWT header
     - `payload`: Base64-encoded JWT payload (contains your Base Build account address)
     - `signature`: Cryptographic signature proving ownership

### Step 3: Update Your Manifest

1. **Open your manifest file**: `.well-known/farcaster.json`

2. **Replace the empty accountAssociation**:
   ```json
   {
     "accountAssociation": {
       "header": "YOUR_GENERATED_HEADER",
       "payload": "YOUR_GENERATED_PAYLOAD",
       "signature": "YOUR_GENERATED_SIGNATURE"
     },
     "baseBuilder": {
       "ownerAddress": "0x54e2bC746Cf63469A0ca1e3c6647BB3cfCE48978"
     },
     "miniapp": {
       ...
     }
   }
   ```

3. **Keep your ownerAddress as-is**
   - The `ownerAddress` can remain `0x54e2bC746Cf63469A0ca1e3c6647BB3cfCE48978`
   - It doesn't need to match your Base Build account address
   - The `accountAssociation` is what proves ownership

### Step 4: Deploy and Verify

1. **Commit and Push**:
   ```bash
   git add .well-known/farcaster.json public/.well-known/farcaster.json
   git commit -m "Add accountAssociation for Base Build ownership verification"
   git push origin main
   ```

2. **Wait for Vercel Deployment** (1-2 minutes)

3. **Verify Manifest is Accessible**:
   ```bash
   curl -s https://farcaster-mini-app-umber.vercel.app/.well-known/farcaster.json | jq .accountAssociation
   ```
   - Should show populated `header`, `payload`, and `signature`

4. **Check in Base Build**:
   - Go back to Base Build
   - Your Mini App should now show as "Verified" or "Ownership Confirmed"
   - The manifest validation should pass

## Multiple Owners (Optional)

If you need to allow multiple addresses to manage the app, use `allowedAddresses` instead of `ownerAddress`:

```json
{
  "baseBuilder": {
    "allowedAddresses": [
      "0x54e2bC746Cf63469A0ca1e3c6647BB3cfCE48978",
      "0xYourOtherAddress..."
    ]
  }
}
```

## Troubleshooting

### Issue: "Invalid accountAssociation"
- **Solution**: Make sure you signed with the wallet connected to your Base Build account
- **Solution**: Verify the domain matches exactly (no trailing slash, no `https://`)

### Issue: "Domain not verified"
- **Solution**: Ensure the manifest is deployed and accessible at `/.well-known/farcaster.json`
- **Solution**: Check that CORS headers are set correctly in `next.config.ts`
- **Solution**: Wait a few minutes for propagation

### Issue: "Owner address mismatch"
- **Solution**: This is normal! `ownerAddress` and Base Build account can be different
- **Solution**: The `accountAssociation` is what matters for verification, not the `ownerAddress`

## Summary

✅ **What you need to do:**
1. Generate `accountAssociation` in Base Build (signs with your Base Build account)
2. Add it to your manifest
3. Deploy and verify

✅ **What you DON'T need to change:**
- `baseBuilder.ownerAddress` can stay as `0x54e2bC746Cf63469A0ca1e3c6647BB3cfCE48978`
- It doesn't need to match your Base Build account address

The `accountAssociation` is the cryptographic proof that links your domain to your Base Build account, regardless of what address you use for `ownerAddress`.

